---
multiTenantAuth:
  enabled: false
  image:
    repository: giantswarm/loki-multi-tenant-proxy-gs
    tag: 0.1.0
    pullPolicy: IfNotPresent
  replicas: 2
  credentials: |-
    users:
      - username: Tenant1
        password: 1tnaneT
        orgid: tenant-1
      - username: Tenant2
        password: 2tnaneT
        orgid: tenant-2
  podSecurityContext:
    fsGroup: 10001
    runAsGroup: 10001
    runAsNonRoot: true
    runAsUser: 10001
  # -- The SecurityContext for Loki containers
  containerSecurityContext:
    readOnlyRootFilesystem: true
    capabilities:
      drop:
        - ALL
    allowPrivilegeEscalation: false

imagePullSecrets: []

giantswarm:
  labelmonitoring:
    enabled: true

global:
  image:
    # -- Overrides the Docker registry globally for all images
    registry: docker.io
  # -- Overrides the priorityClassName for all pods
  priorityClassName: null
  # -- configures cluster domain ("cluster.local" by default)
  clusterDomain: "cluster.local"
  # -- configures DNS service name
  dnsService: "coredns"
  # -- configures DNS service namespace
  dnsNamespace: "kube-system"

serviceAccount:
  # -- Specifies whether a ServiceAccount should be created
  create: true
  # -- The name of the ServiceAccount to use.
  # If not set and create is true, a name is generated using the fullname template
  name: loki
  # -- Image pull secrets for the service account
  imagePullSecrets: []
  # -- Annotations for the service account
  annotations: {}
  # -- Set this toggle to false to opt out of automounting API credentials for the service account
  automountServiceAccountToken: true

loki:
  gateway:
    nginxConfig:
      genMultiTenant: false
    replicas: 3
    deploymentStrategy:
      type: RollingUpdate
      rollingUpdate:
        maxSurge: 0
        maxUnavailable: 1
    image:
      repository: giantswarm/nginx-unprivileged

  read:
    # 2023-01-31: disable new "backend" read mode as it's not yet part of official images
    legacyReadTarget: true
    resources:
      limits:
        memory: 4096Mi
      requests:
        memory: 3072Mi
        cpu: 200m
    extraArgs:
      - -querier.multi-tenant-queries-enabled

  write:
    resources:
      limits:
        memory: 4096Mi
      requests:
        memory: 3072Mi
        cpu: 200m

  loki:
    image:
      repository: giantswarm/loki
      # If no value given here, will use upstream chart's "appVersion"
      tag: ""
    limits_config:
      enforce_metric_name: true
      ingestion_rate_mb: 10
      ingestion_burst_size_mb: 20
      max_concurrent_tail_requests: 20

  rbac:
    pspEnabled: true

  monitoring:
    dashboards:
      enabled: false
    rules:
      enabled: false
    alerts:
      enabled: false
    serviceMonitor:
      enabled: false
    selfMonitoring:
      enabled: false
      grafanaAgent:
        installOperator: false
    lokiCanary:
      enabled: false

  test:
    enabled: false
